<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Home Buyer Report - Melbourne 2024</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .profile-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .profile-item {
            text-align: center;
        }
        
        .profile-item .label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .profile-item .value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: attr(data-icon);
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        .eligibility-status {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .eligibility-status h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .schemes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .scheme-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #3498db;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .scheme-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .scheme-card h4 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .scheme-card .category {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .scheme-card ul {
            list-style: none;
        }
        
        .scheme-card li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .scheme-card li::before {
            content: "✓";
            color: #27ae60;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .borrowing-capacity {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }
        
        .borrowing-capacity h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .borrowing-capacity .amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .costs-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .cost-item {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.2s;
        }
        
        .cost-item:hover {
            border-color: #3498db;
        }
        
        .cost-item h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .cost-item .amount {
            font-size: 1.3rem;
            font-weight: 600;
            color: #e74c3c;
        }
        
        .recommendation {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .recommendation h3 {
            font-size: 1.6rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .recommendation .price-range {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
        }
        
        .recommendation p {
            font-size: 1.1rem;
            text-align: center;
            opacity: 0.95;
        }
        
        .footer {
            background: #34495e;
            color: white;
            padding: 20px 30px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .calculator {
            background: linear-gradient(135deg, #16a085, #1abc9c);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .calculator h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .calculator-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }
        
        .calculate-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
        }
        
        .calculate-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .results {
            display: none;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .results.show {
            display: block;
        }
        
        .monthly-total {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .monthly-total h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .monthly-total .amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .cost-comparison {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .comparison-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
        }
        
        .comparison-item .label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .comparison-item .value {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .cost-breakdown-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .detail-item .label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .detail-item .value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .affordability-indicator {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }
        
        .affordable {
            background: rgba(39, 174, 96, 0.8);
        }
        
        .marginal {
            background: rgba(243, 156, 18, 0.8);
        }
        
        .unaffordable {
            background: rgba(231, 76, 60, 0.8);
        }
        
        /* OpenRouter API Settings */
        .settings-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        
        .settings-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .settings-header h3 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .settings-form-group {
            margin-bottom: 20px;
        }
        
        .settings-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .settings-form-group input, .settings-form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .settings-form-group input:focus, .settings-form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .api-status {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .api-status.disconnected {
            background: #fee;
            color: #c0392b;
            border: 1px solid #e74c3c;
        }
        
        .api-status.connecting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }
        
        .api-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #28a745;
        }
        
        .settings-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .btn-secondary, .btn-primary, .btn-test {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-test {
            background: #f39c12;
            color: white;
        }
        
        .btn-test:hover {
            background: #e67e22;
        }
        
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            transition: all 0.3s;
            z-index: 999;
        }
        
        .settings-btn:hover {
            background: #2980b9;
            transform: scale(1.1);
        }
        
        .ai-assistant {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .ai-assistant.disabled {
            background: #95a5a6;
            opacity: 0.7;
        }
        
        .ai-assistant h4 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .ai-prompt-area {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            font-size: 1rem;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 15px;
        }
        
        .ai-prompt-area:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
        }
        
        .ai-response {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .ai-response.show {
            display: block;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .profile-card {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .borrowing-capacity .amount {
                font-size: 2rem;
            }
            
            .costs-breakdown {
                grid-template-columns: 1fr;
            }
            
            .calculator-form {
                grid-template-columns: 1fr;
            }
            
            .monthly-total .amount {
                font-size: 2rem;
            }
            
            .cost-comparison {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Settings Button -->
    <button class="settings-btn" onclick="openSettings()" title="API Settings">⚙️</button>
    
    <!-- Settings Overlay -->
    <div class="settings-overlay" id="settings-overlay">
        <div class="settings-modal">
            <div class="settings-header">
                <h3>🔧 OpenRouter API Settings</h3>
                <button class="close-btn" onclick="closeSettings()">×</button>
            </div>
            
            <div class="settings-form-group">
                <label for="api-key">API Key</label>
                <input type="password" id="api-key" placeholder="Enter your OpenRouter API key">
                <small style="color: #7f8c8d;">Get your API key from <a href="https://openrouter.ai/keys" target="_blank" style="color: #3498db;">OpenRouter Dashboard</a></small>
            </div>
            
            <div class="settings-form-group">
                <label for="app-name">App Name (Optional)</label>
                <input type="text" id="app-name" placeholder="First Home Buyer Assistant" value="First Home Buyer Assistant">
            </div>
            
            <div class="settings-form-group">
                <label for="app-url">App URL (Optional)</label>
                <input type="url" id="app-url" placeholder="https://your-domain.com">
            </div>
            
            <div class="settings-form-group">
                <label for="selected-model">AI Model</label>
                <select id="selected-model">
                    <option value="">Select a model (test connection first)</option>
                </select>
            </div>
            
            <div class="api-status disconnected" id="api-status">
                🔴 Disconnected - Enter API key and test connection
            </div>
            
            <div class="settings-buttons">
                <button class="btn-test" onclick="testConnection()">Test Connection</button>
                <button class="btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <header class="header">
            <h1>First Home Buyer Report</h1>
            <p class="subtitle">Melbourne, Australia - 2024/2025</p>
            
            <div class="profile-card">
                <div class="profile-item">
                    <div class="label">Status</div>
                    <div class="value">NZ Citizen</div>
                </div>
                <div class="profile-item">
                    <div class="label">Income</div>
                    <div class="value">$90,000</div>
                </div>
                <div class="profile-item">
                    <div class="label">Current Rent</div>
                    <div class="value">$2,000/mo</div>
                </div>
                <div class="profile-item">
                    <div class="label">Relationship</div>
                    <div class="value">Single</div>
                </div>
            </div>
        </header>
        
        <main class="content">
            <section class="section">
                <div class="eligibility-status">
                    <h3>🎉 Great News: You're Eligible!</h3>
                    <p>As a NZ citizen on a Special Category Visa (444), you can access most Australian first home buyer schemes.</p>
                </div>
            </section>
            
            <section class="section">
                <h2 data-icon="🏠">Available Schemes</h2>
                
                <div class="schemes-grid">
                    <div class="scheme-card">
                        <div class="category">Federal</div>
                        <h4>First Home Guarantee</h4>
                        <ul>
                            <li>5% deposit required</li>
                            <li>No Lenders Mortgage Insurance</li>
                            <li>Income limit $125K (you qualify)</li>
                            <li>Available for existing and new homes</li>
                        </ul>
                    </div>
                    
                    <div class="scheme-card">
                        <div class="category">Federal</div>
                        <h4>Help to Buy Scheme</h4>
                        <ul>
                            <li>2% deposit required</li>
                            <li>Government contributes 30-40% equity</li>
                            <li>Income limit $90K (you qualify)</li>
                            <li>No rent on government share</li>
                        </ul>
                    </div>
                    
                    <div class="scheme-card">
                        <div class="category">Federal</div>
                        <h4>First Home Super Saver</h4>
                        <ul>
                            <li>Access up to $50K from superannuation</li>
                            <li>Available to NZ citizens</li>
                            <li>Tax advantages on contributions</li>
                            <li>Must use for deposit within 12 months</li>
                        </ul>
                    </div>
                    
                    <div class="scheme-card">
                        <div class="category">Victoria</div>
                        <h4>Stamp Duty Exemption</h4>
                        <ul>
                            <li>FREE for properties ≤ $600K</li>
                            <li>Partial exemption $600K - $750K</li>
                            <li>Potential savings of $20K+</li>
                            <li>Must be first home buyer</li>
                        </ul>
                    </div>
                    
                    <div class="scheme-card">
                        <div class="category">Victoria</div>
                        <h4>First Home Owner Grant</h4>
                        <ul>
                            <li>$10,000 for new homes</li>
                            <li>Properties ≤ $750K</li>
                            <li>Ending June 2025</li>
                            <li>Must live in property for 12 months</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <section class="section">
                <h2 data-icon="💰">Borrowing Capacity</h2>
                <div class="borrowing-capacity">
                    <h3>Estimated Borrowing Power</h3>
                    <div class="amount">$400K - $500K</div>
                    <p>Based on $90K income (varies by lender and expenses)</p>
                </div>
            </section>
            
            <section class="section">
                <h2 data-icon="💸">Ongoing Ownership Costs</h2>
                <div class="costs-breakdown">
                    <div class="cost-item">
                        <h4>Council Rates</h4>
                        <div class="amount">$1,500 - $3,000/year</div>
                    </div>
                    <div class="cost-item">
                        <h4>Home Insurance</h4>
                        <div class="amount">~$2,000/year</div>
                    </div>
                    <div class="cost-item">
                        <h4>Strata Fees</h4>
                        <div class="amount">$500 - $2,500/quarter</div>
                    </div>
                    <div class="cost-item">
                        <h4>Maintenance</h4>
                        <div class="amount">1-3% of property value</div>
                    </div>
                </div>
            </section>
            
            <section class="section">
                <h2 data-icon="🧮">Property Calculator</h2>
                <div class="calculator">
                    <h3>Calculate Total Monthly Ownership Costs</h3>
                    <p style="text-align: center; margin-bottom: 25px; opacity: 0.9;">Enter property details below to see projected monthly costs compared to your current $2,000/month rent</p>
                    
                    <div class="calculator-form">
                        <div class="form-group">
                            <label for="property-price">Property Price ($)</label>
                            <input type="number" id="property-price" placeholder="e.g. 650000" min="0" step="1000">
                        </div>
                        
                        <div class="form-group">
                            <label for="deposit-percent">Deposit (%)</label>
                            <select id="deposit-percent">
                                <option value="2">2% (Help to Buy)</option>
                                <option value="5" selected>5% (First Home Guarantee)</option>
                                <option value="10">10%</option>
                                <option value="20">20%</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="interest-rate">Interest Rate (%)</label>
                            <input type="number" id="interest-rate" value="6.5" min="1" max="15" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label for="loan-term">Loan Term (years)</label>
                            <select id="loan-term">
                                <option value="25">25</option>
                                <option value="30" selected>30</option>
                                <option value="35">35</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="property-type">Property Type</label>
                            <select id="property-type">
                                <option value="house">House</option>
                                <option value="apartment" selected>Apartment/Unit</option>
                                <option value="townhouse">Townhouse</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="strata-fees">Strata Fees ($/quarter)</label>
                            <input type="number" id="strata-fees" placeholder="e.g. 1500" min="0" step="100">
                            <small style="opacity: 0.8; font-size: 0.85rem;">Enter 0 for houses</small>
                        </div>
                    </div>
                    
                    <button class="calculate-btn" onclick="calculateCosts()">Calculate Monthly Costs</button>
                    
                    <div class="results" id="results">
                        <div class="monthly-total">
                            <h4>Total Monthly Cost</h4>
                            <div class="amount" id="total-monthly">$0</div>
                        </div>
                        
                        <div class="cost-comparison">
                            <div class="comparison-item">
                                <div class="label">Current Rent</div>
                                <div class="value">$2,000</div>
                            </div>
                            <div class="comparison-item">
                                <div class="label">Difference</div>
                                <div class="value" id="difference">$0</div>
                            </div>
                        </div>
                        
                        <div class="cost-breakdown-details">
                            <div class="detail-item">
                                <div class="label">Loan Repayment</div>
                                <div class="value" id="loan-payment">$0</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Council Rates</div>
                                <div class="value" id="council-rates">$0</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Home Insurance</div>
                                <div class="value" id="insurance">$0</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Strata Fees</div>
                                <div class="value" id="strata">$0</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Maintenance</div>
                                <div class="value" id="maintenance">$0</div>
                            </div>
                            <div class="detail-item">
                                <div class="label">Stamp Duty Saved</div>
                                <div class="value" id="stamp-duty">$0</div>
                            </div>
                        </div>
                        
                        <div class="affordability-indicator" id="affordability">
                            Assessment will appear here
                        </div>
                    </div>
                    
                    <!-- AI Assistant Integration -->
                    <div class="ai-assistant disabled" id="ai-assistant">
                        <h4>🤖 AI Property Analysis</h4>
                        <p style="margin-bottom: 15px; opacity: 0.9;">Get personalized insights about this property from AI</p>
                        <textarea class="ai-prompt-area" id="ai-prompt" placeholder="Ask about this property... e.g., 'Is this a good investment?', 'What are the pros and cons?', 'Should I consider this property given my situation?'" disabled></textarea>
                        <button class="calculate-btn" onclick="askAI()" disabled id="ai-ask-btn">Configure API in Settings First</button>
                        <div class="ai-response" id="ai-response"></div>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2 data-icon="🎯">Cost-Neutral Analysis</h2>
                <div class="recommendation">
                    <h3>Recommended Purchase Price Range</h3>
                    <div class="price-range">$600K - $650K</div>
                    <p>This range maximizes stamp duty savings while keeping total ownership costs similar to your current $2,000/month rent</p>
                </div>
                
                <div style="background: #ecf0f1; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">Key Strategy Points:</h4>
                    <ul style="color: #2c3e50;">
                        <li style="margin: 10px 0;">Focus on properties under $600K for maximum stamp duty savings</li>
                        <li style="margin: 10px 0;">Consider the Help to Buy scheme for lower deposit requirements</li>
                        <li style="margin: 10px 0;">Factor in all ongoing costs when calculating affordability</li>
                        <li style="margin: 10px 0;">Get pre-approval to understand exact borrowing capacity</li>
                    </ul>
                </div>
            </section>
        </main>
        
        <footer class="footer">
            <p>Report generated on August 25, 2024 • Data based on current government schemes and market conditions</p>
        </footer>
    </div>

    <script>
        function calculateCosts() {
            // Get input values
            const propertyPrice = parseFloat(document.getElementById('property-price').value) || 0;
            const depositPercent = parseFloat(document.getElementById('deposit-percent').value) || 5;
            const interestRate = parseFloat(document.getElementById('interest-rate').value) || 6.5;
            const loanTermYears = parseFloat(document.getElementById('loan-term').value) || 30;
            const propertyType = document.getElementById('property-type').value;
            const strataFeesQuarterly = parseFloat(document.getElementById('strata-fees').value) || 0;
            
            if (propertyPrice <= 0) {
                alert('Please enter a valid property price');
                return;
            }
            
            // Calculate loan details
            const depositAmount = propertyPrice * (depositPercent / 100);
            const loanAmount = propertyPrice - depositAmount;
            const monthlyRate = interestRate / 100 / 12;
            const totalPayments = loanTermYears * 12;
            
            // Calculate monthly loan payment using PMT formula
            const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, totalPayments)) / 
                                 (Math.pow(1 + monthlyRate, totalPayments) - 1);
            
            // Calculate other monthly costs
            const councilRatesMonthly = 200; // Average $2,400/year
            const insuranceMonthly = 165; // Average $2,000/year
            const strataMonthly = strataFeesQuarterly / 3; // Convert quarterly to monthly
            const maintenanceMonthly = (propertyPrice * 0.015) / 12; // 1.5% of property value annually
            
            // Calculate stamp duty savings
            let stampDutySavings = 0;
            if (propertyPrice <= 600000) {
                stampDutySavings = calculateStampDuty(propertyPrice);
            } else if (propertyPrice <= 750000) {
                const fullDuty = calculateStampDuty(propertyPrice);
                const concession = Math.max(0, (750000 - propertyPrice) / 150000);
                stampDutySavings = fullDuty * concession;
            }
            
            // Total monthly cost
            const totalMonthly = monthlyPayment + councilRatesMonthly + insuranceMonthly + 
                               strataMonthly + maintenanceMonthly;
            
            // Update results
            document.getElementById('total-monthly').textContent = `$${Math.round(totalMonthly).toLocaleString()}`;
            document.getElementById('loan-payment').textContent = `$${Math.round(monthlyPayment).toLocaleString()}`;
            document.getElementById('council-rates').textContent = `$${councilRatesMonthly}`;
            document.getElementById('insurance').textContent = `$${insuranceMonthly}`;
            document.getElementById('strata').textContent = `$${Math.round(strataMonthly)}`;
            document.getElementById('maintenance').textContent = `$${Math.round(maintenanceMonthly)}`;
            document.getElementById('stamp-duty').textContent = `$${Math.round(stampDutySavings).toLocaleString()}`;
            
            // Calculate difference from current rent
            const difference = totalMonthly - 2000;
            const differenceEl = document.getElementById('difference');
            differenceEl.textContent = `${difference >= 0 ? '+' : ''}$${Math.round(difference).toLocaleString()}`;
            differenceEl.style.color = difference > 0 ? '#e74c3c' : '#27ae60';
            
            // Affordability assessment
            const affordabilityEl = document.getElementById('affordability');
            if (difference <= 200) {
                affordabilityEl.className = 'affordability-indicator affordable';
                affordabilityEl.textContent = '✅ Highly Affordable - Similar or lower cost than current rent';
            } else if (difference <= 500) {
                affordabilityEl.className = 'affordability-indicator marginal';
                affordabilityEl.textContent = '⚠️ Moderately Higher - Consider your budget carefully';
            } else {
                affordabilityEl.className = 'affordability-indicator unaffordable';
                affordabilityEl.textContent = '❌ Significantly Higher - May strain your budget';
            }
            
            // Show results
            document.getElementById('results').classList.add('show');
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        function calculateStampDuty(propertyValue) {
            // Victoria stamp duty calculation
            if (propertyValue <= 25000) return 1.4 * (propertyValue / 100);
            if (propertyValue <= 130000) return 350 + 2.4 * ((propertyValue - 25000) / 100);
            if (propertyValue <= 960000) return 2870 + 6 * ((propertyValue - 130000) / 100);
            return 52670 + 6.5 * ((propertyValue - 960000) / 100);
        }
        
        // Auto-calculate strata fees based on property type
        document.getElementById('property-type').addEventListener('change', function() {
            const strataField = document.getElementById('strata-fees');
            if (this.value === 'house') {
                strataField.value = '0';
                strataField.disabled = true;
            } else {
                strataField.disabled = false;
                if (!strataField.value || strataField.value === '0') {
                    strataField.value = this.value === 'apartment' ? '1500' : '1000';
                }
            }
        });
        
        // Initialize strata fees based on default selection
        document.getElementById('property-type').dispatchEvent(new Event('change'));
        
        // OpenRouter API Integration
        let apiConfig = {
            apiKey: '',
            appName: 'First Home Buyer Assistant',
            appUrl: '',
            selectedModel: '',
            isConnected: false,
            availableModels: []
        };
        
        // Load saved settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('openrouter-settings');
            if (saved) {
                apiConfig = { ...apiConfig, ...JSON.parse(saved) };
                document.getElementById('api-key').value = apiConfig.apiKey;
                document.getElementById('app-name').value = apiConfig.appName;
                document.getElementById('app-url').value = apiConfig.appUrl;
                document.getElementById('selected-model').value = apiConfig.selectedModel;
                
                if (apiConfig.apiKey && apiConfig.isConnected) {
                    updateConnectionStatus('connected', '🟢 Connected');
                    enableAIAssistant();
                }
            }
        }
        
        // Save settings to localStorage
        function saveSettings() {
            apiConfig.apiKey = document.getElementById('api-key').value;
            apiConfig.appName = document.getElementById('app-name').value;
            apiConfig.appUrl = document.getElementById('app-url').value;
            apiConfig.selectedModel = document.getElementById('selected-model').value;
            
            localStorage.setItem('openrouter-settings', JSON.stringify(apiConfig));
            closeSettings();
            
            if (apiConfig.isConnected) {
                enableAIAssistant();
            }
        }
        
        // Open settings modal
        function openSettings() {
            document.getElementById('settings-overlay').classList.add('show');
        }
        
        // Close settings modal
        function closeSettings() {
            document.getElementById('settings-overlay').classList.remove('show');
        }
        
        // Update connection status display
        function updateConnectionStatus(status, message) {
            const statusEl = document.getElementById('api-status');
            statusEl.className = `api-status ${status}`;
            statusEl.textContent = message;
        }
        
        // Test API connection
        async function testConnection() {
            const apiKey = document.getElementById('api-key').value;
            if (!apiKey.trim()) {
                alert('Please enter your OpenRouter API key');
                return;
            }
            
            updateConnectionStatus('connecting', '🟡 Testing connection...');
            
            try {
                // First, test the connection by fetching available models
                const modelsResponse = await fetch('https://openrouter.ai/api/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        ...(apiConfig.appUrl && { 'HTTP-Referer': apiConfig.appUrl }),
                        ...(apiConfig.appName && { 'X-Title': apiConfig.appName })
                    }
                });
                
                if (!modelsResponse.ok) {
                    throw new Error(`HTTP ${modelsResponse.status}: ${modelsResponse.statusText}`);
                }
                
                const modelsData = await modelsResponse.json();
                apiConfig.availableModels = modelsData.data || [];
                
                // Populate model dropdown
                const modelSelect = document.getElementById('selected-model');
                modelSelect.innerHTML = '<option value="">Select a model</option>';
                
                // Filter and sort models by popularity/capability
                const popularModels = apiConfig.availableModels
                    .filter(model => model.id && model.name)
                    .sort((a, b) => {
                        // Prioritize GPT and Claude models
                        if (a.id.includes('gpt') || a.id.includes('claude')) return -1;
                        if (b.id.includes('gpt') || b.id.includes('claude')) return 1;
                        return a.name.localeCompare(b.name);
                    });
                
                popularModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    option.textContent = `${model.name} (${model.id})`;
                    modelSelect.appendChild(option);
                });
                
                // Test with a simple completion
                const testResponse = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                        ...(apiConfig.appUrl && { 'HTTP-Referer': apiConfig.appUrl }),
                        ...(apiConfig.appName && { 'X-Title': apiConfig.appName })
                    },
                    body: JSON.stringify({
                        model: 'openai/gpt-3.5-turbo',
                        messages: [{ role: 'user', content: 'Hello! Just testing the connection.' }],
                        max_tokens: 10
                    })
                });
                
                if (!testResponse.ok) {
                    throw new Error(`Chat API test failed: HTTP ${testResponse.status}`);
                }
                
                await testResponse.json();
                
                // Success!
                apiConfig.isConnected = true;
                updateConnectionStatus('connected', `🟢 Connected! Found ${popularModels.length} available models`);
                
                // Auto-select a good default model
                if (!apiConfig.selectedModel && popularModels.length > 0) {
                    const defaultModel = popularModels.find(m => 
                        m.id.includes('gpt-4') || m.id.includes('claude') || m.id.includes('gpt-3.5')
                    ) || popularModels[0];
                    document.getElementById('selected-model').value = defaultModel.id;
                    apiConfig.selectedModel = defaultModel.id;
                }
                
            } catch (error) {
                console.error('Connection test failed:', error);
                apiConfig.isConnected = false;
                updateConnectionStatus('disconnected', `🔴 Connection failed: ${error.message}`);
            }
        }
        
        // Enable AI assistant functionality
        function enableAIAssistant() {
            const aiAssistant = document.getElementById('ai-assistant');
            const aiPrompt = document.getElementById('ai-prompt');
            const aiBtn = document.getElementById('ai-ask-btn');
            
            aiAssistant.classList.remove('disabled');
            aiPrompt.disabled = false;
            aiBtn.disabled = false;
            aiBtn.textContent = 'Ask AI';
        }
        
        // Ask AI function
        async function askAI() {
            const prompt = document.getElementById('ai-prompt').value.trim();
            if (!prompt) {
                alert('Please enter a question about the property');
                return;
            }
            
            if (!apiConfig.isConnected || !apiConfig.selectedModel) {
                alert('Please configure and test your API connection first');
                return;
            }
            
            const responseEl = document.getElementById('ai-response');
            const aiBtn = document.getElementById('ai-ask-btn');
            
            // Show loading state
            aiBtn.innerHTML = '<span class="loading-spinner"></span> Analyzing...';
            aiBtn.disabled = true;
            responseEl.innerHTML = '<div class="loading-spinner"></div> AI is analyzing your question...';
            responseEl.classList.add('show');
            
            try {
                // Get current property data for context
                const propertyPrice = document.getElementById('property-price').value || 'Not specified';
                const depositPercent = document.getElementById('deposit-percent').value || '5';
                const propertyType = document.getElementById('property-type').value || 'apartment';
                const strataFees = document.getElementById('strata-fees').value || '0';
                
                const systemPrompt = `You are a helpful first home buyer assistant for someone in Melbourne, Australia. 

Current user profile:
- Status: NZ citizen (eligible for first home buyer schemes)
- Income: $90,000 annually
- Currently paying: $2,000/month rent
- Single buyer

Current property being analyzed:
- Price: $${propertyPrice}
- Property type: ${propertyType}
- Deposit: ${depositPercent}%
- Strata fees: $${strataFees}/quarter

Provide helpful, specific advice about this property considering their situation, Melbourne market conditions, and available first home buyer schemes. Be concise but informative.`;
                
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiConfig.apiKey}`,
                        'Content-Type': 'application/json',
                        ...(apiConfig.appUrl && { 'HTTP-Referer': apiConfig.appUrl }),
                        ...(apiConfig.appName && { 'X-Title': apiConfig.appName })
                    },
                    body: JSON.stringify({
                        model: apiConfig.selectedModel,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed: HTTP ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices?.[0]?.message?.content || 'No response received';
                
                responseEl.innerHTML = `<strong>🤖 AI Analysis:</strong><br><br>${aiResponse.replace(/\n/g, '<br>')}`;
                
            } catch (error) {
                console.error('AI request failed:', error);
                responseEl.innerHTML = `<strong>❌ Error:</strong> ${error.message}<br><br>Please check your API configuration and try again.`;
            } finally {
                aiBtn.innerHTML = 'Ask AI';
                aiBtn.disabled = false;
            }
        }
        
        // Close settings when clicking outside modal
        document.getElementById('settings-overlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettings();
            }
        });
        
        // Load settings on page load
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>